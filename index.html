<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Oodles Search</title>
   <link rel="icon" href="2025_09_13_0vp_Kleki.png" type="image/png">
  <style>
   
    body { background-color: #c0c0c0; font-family: "Courier New", Courier, monospace; color: #000080; margin: 0; }
    header { background-color: #000080; text-align: center; padding: 20px; border-bottom: 3px double #fff; }
    header img { max-height: 120px; }
    nav { background-color: #e0e0e0; padding: 10px; text-align: center; }
    nav button { margin: 0 5px; padding: 5px 10px; font-size: 14px; background-color: #000080; color: white; border: 2px outset #fff; cursor: pointer; }
    nav button:hover { background-color: #ffcc00; color: #000; }
    .container { padding: 20px; max-width: 980px; margin: 0 auto; }
    .panel { background-color: #fff; border: 2px groove #808080; padding: 15px; margin-bottom: 20px; }
    .panel h3 { margin-top: 0; }
    input[type="text"], textarea { width: 100%; padding: 8px; font-size: 16px; border: 2px inset #808080; background-color: #fff; }
    textarea { min-height: 100px; }
    .actions { margin-top: 10px; }
    .actions button { padding: 8px 16px; font-size: 14px; background-color: #000080; color: white; border: 2px outset #fff; cursor: pointer; }
    .actions button:hover { background-color: #ffcc00; color: #000; }
    .results { margin-top: 10px; font-size: 14px; }
    .result-block { margin-bottom: 12px; }
    .result-block a { color: #000080; font-weight: bold; text-decoration: none; }
    .result-block a:hover { text-decoration: underline; }
    footer { text-align: center; margin-top: 40px; font-size: 12px; color: #333; }
    .two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    @media (max-width: 700px) { .two-col { grid-template-columns: 1fr; } }
    .small { font-size: 12px; color: #333; }
    .pagination { display: flex; gap: 8px; align-items: center; margin-top: 10px; }
    .pagination button { padding: 4px 10px; }
    .score { color: #555; font-size: 12px; }
  </style>
</head>
<body>
  <header>
    <img src="https://stenoip.github.io/oodles/2025_09_13_0vp_Kleki.png" alt="Oodles Logo">
  </header>
  <nav>
    <button onclick="switchTab('generate')">Generate</button>
    <button onclick="switchTab('upload')">Upload</button>
    <button onclick="switchTab('search')">Search</button>
    <button onclick="switchTab('metasearch')">MetaSearch</button>
    <button onclick="window.location.href='https://stenoip.github.io/learn-centre'">Stenoip Wonder Computer(Web-Portal)</button>
    <button onclick="window.location.href='https://stenoip.github.io/learn-centre'">News</button>
    <button onclick="window.location.href='https://stenoip.github.io/maps'">Maps</button>
    <hr>
    <button onclick="switchTab('about')">About</button>
  </nav>
  <div class="container"></div>
  <footer>© Stenoip Company</footer>
  <p>Officially launched on Sunday 19th October 2025.</p>

  <script>
  var BACKEND_BASE = 'https://oodles-backend.vercel.app';
  var state = { q: '', page: 1, pageSize: 10, total: 0 };

  function setActiveTab(tab) {
    document.getElementById('tab-metasearch')?.classList.remove('active-tab');
    document.getElementById('tab-about')?.classList.remove('active-tab');
    if (tab === 'metasearch') document.getElementById('tab-metasearch')?.classList.add('active-tab');
    if (tab === 'about') document.getElementById('tab-about')?.classList.add('active-tab');
  }

  function switchTab(tab) {
    setActiveTab(tab);
    var container = document.querySelector('.container');
    container.innerHTML = '';

    if (tab === 'metasearch') {
      container.innerHTML = `
        <div class="panel">
          <h3>Oodlebot MetaSearch</h3>
          <input type="text" id="query" placeholder="Search the web..." />
          <div class="actions">
            <button onclick="runMetaSearch(1)">Search</button>
          </div>
          <div class="results" id="results"></div>
          <div class="pagination" id="pager" style="display:none;">
            <button onclick="prevPage()">Prev</button>
            <span id="pageInfo"></span>
            <button onclick="nextPage()">Next</button>
          </div>
        </div>
      `;
      document.getElementById('query').addEventListener('keydown', function(e) {
        if (e.key === 'Enter') runMetaSearch(1);
      });
    }

    if (tab === 'about') {
      container.innerHTML = `
        <div class="panel">
          <h3>About Oodles Search</h3>
          <p>Oodles is a metasearch engine blending results from Brave, Bing, Yahoo, and Ecosia with smart deduping and scoring.</p>
        </div>
      `;
    }
  }

  async function runMetaSearch(toPage) {
    var q = document.getElementById('query')?.value.trim();
    if (!q) {
      document.getElementById('results').innerHTML = '<div class="small">Please enter a search query.</div>';
      document.getElementById('pager').style.display = 'none';
      return;
    }
    state.q = q;
    state.page = toPage || 1;

    var resultsEl = document.getElementById('results');
    resultsEl.innerHTML = '<div class="small">Searching…</div>';

    try {
      const url = `${BACKEND_BASE}/metasearch?q=${encodeURIComponent(state.q)}&page=${state.page}&pageSize=${state.pageSize}`;
      const resp = await fetch(url);
      if (!resp.ok) throw new Error('Search failed');
      const data = await resp.json();
      state.total = data.total;
      renderResults(data.items, data.page, data.pageSize, data.total);
    } catch (e) {
      resultsEl.innerHTML = '<div class="small">Something went wrong. Please try again.</div>';
      document.getElementById('pager').style.display = 'none';
    }
  }

  function renderResults(items, page, pageSize, total) {
    var resultsEl = document.getElementById('results');
    if (!items || items.length === 0) {
      resultsEl.innerHTML = '<div class="small">No results found.</div>';
      document.getElementById('pager').style.display = 'none';
      return;
    }

    resultsEl.innerHTML = items.map(r => `
      <div class="result-block">
        <a href="${r.url}" target="_blank" rel="noopener">${escapeHtml(r.title)}</a>
        <div class="small">${escapeHtml(r.url)}</div>
        <div>${escapeHtml(r.snippet || '')}</div>
        <div class="score">Source: ${r.source} • Score: ${r.score.toFixed(2)}</div>
      </div>
    `).join('');

    var totalPages = Math.max(1, Math.ceil(total / pageSize));
    var pager = document.getElementById('pager');
    pager.style.display = 'flex';
    document.getElementById('pageInfo').textContent = `Page ${page} of ${totalPages}`;
  }

  function prevPage() {
    if (state.page > 1) runMetaSearch(state.page - 1);
  }
  function nextPage() {
    var totalPages = Math.max(1, Math.ceil(state.total / state.pageSize));
    if (state.page < totalPages) runMetaSearch(state.page + 1);
  }

  function escapeHtml(s) {
    return String(s)
      .replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;');
  }

  // Initialize default tab
  switchTab('metasearch');
</script>

</body>
</html>
