<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Oodles World Search</title>
  <style>
    /* Reset & Base */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      font-family: 'Segoe UI', sans-serif;
      background: radial-gradient(circle at top, #1e3c72, #2a5298, #0f2027);
      color: #fff;
      overflow: hidden;
      position: relative;
    }

    /* Floating particles background */
    .particles {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      overflow: hidden; z-index: 0; pointer-events: none;
    }
    .particles span {
      position: absolute; display: block; width: 4px; height: 4px;
      background: rgba(0,255,255,0.8); border-radius: 50%;
      animation: float 10s linear infinite;
    }
    @keyframes float {
      0% { transform: translateY(100vh) scale(0.5); opacity: 0; }
      50% { opacity: 1; }
      100% { transform: translateY(-10vh) scale(1.2); opacity: 0; }
    }

    /* Title */
    h1 {
      font-size: 3.5em;
      text-shadow: 0 0 15px #00f0ff, 0 0 30px #00f0ff;
      margin-bottom: 20px;
      z-index: 2;
      animation: glowPulse 3s infinite alternate;
      pointer-events: none;
    }
    @keyframes glowPulse {
      from { text-shadow: 0 0 10px #00f0ff, 0 0 20px #00f0ff; }
      to { text-shadow: 0 0 25px #00f0ff, 0 0 50px #00f0ff; }
    }

    /* Search Box */
    .search-box {
      display: flex; z-index: 2;
      transform-style: preserve-3d; perspective: 800px;
      animation: floatBox 6s ease-in-out infinite;
    }
    @keyframes floatBox {
      0%, 100% { transform: translateY(0) rotateX(10deg); }
      50% { transform: translateY(-10px) rotateX(15deg); }
    }
    input[type="text"] {
      padding: 15px 20px; width: 380px; font-size: 18px; border: none;
      border-radius: 10px 0 0 10px; background: rgba(28,28,28,0.9); color: #fff;
      outline: none; box-shadow: inset 0 0 12px rgba(0, 255, 255, 0.4);
      transition: box-shadow 0.3s;
    }
    input[type="text"]:focus { box-shadow: inset 0 0 20px rgba(0, 255, 255, 0.7); }
    button {
      padding: 15px 30px; font-size: 18px; border: none; border-radius: 0 10px 10px 0;
      background: linear-gradient(135deg, #00f0ff, #00ffa3); color: #000; cursor: pointer;
      transition: transform 0.3s, box-shadow 0.3s;
      box-shadow: 0 5px 20px rgba(0, 255, 255, 0.5);
    }
    button:hover { transform: translateY(-3px) scale(1.05); box-shadow: 0 10px 30px rgba(0, 255, 255, 0.7); }

    /* Three.js canvas container */
    .city-container {
      position: absolute; bottom: 0; left: 0; width: 100%; height: 55vh;
      z-index: 1;
      /* soft fade at horizon */
      box-shadow: 0 -40px 100px rgba(0, 255, 255, 0.15) inset;
    }
    canvas { display: block; }

    /* Footer */
    footer {
      position: absolute; bottom: 15px; font-size: 14px; color: #aaa;
      text-shadow: 0 0 5px #000; z-index: 2;
    }
  </style>
</head>
<body>
  <div class="particles">
    <span style="left:8%; animation-duration:12s;"></span>
    <span style="left:22%; animation-duration:15s;"></span>
    <span style="left:37%; animation-duration:18s;"></span>
    <span style="left:54%; animation-duration:20s;"></span>
    <span style="left:71%; animation-duration:14s;"></span>
    <span style="left:88%; animation-duration:16s;"></span>
    <span style="left:96%; animation-duration:19s;"></span>
  </div>

  <h1>Oodles World Search</h1>
  <div class="search-box">
    <input type="text" id="searchInput" placeholder="Search the 3D city..." />
    <button onclick="search()">Search</button>
  </div>

  <!-- Three.js scene -->
  <div class="city-container" id="city"></div>

  <footer>
    &copy; <span id="year"></span> Stenoip Company
  </footer>

  <!-- Three.js & Controls via CDN -->
  <script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>
  <script src="https://unpkg.com/three@0.160.0/examples/js/controls/OrbitControls.js"></script>

  <script>
    // Search behavior
    function search() {
      const query = document.getElementById("searchInput").value.trim();
      if (query) {
        const url = "https://stenoip.github.io/oodles/world-search?q=" + encodeURIComponent(query);
        window.open(url, "_blank");
      }
    }
    document.getElementById("year").textContent = new Date().getFullYear();

    // ===== THREE.JS CITY SETUP =====
    const container = document.getElementById('city');
    const scene = new THREE.Scene();
    scene.fog = new THREE.FogExp2(0x0f2027, 0.012);

    const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
    renderer.setPixelRatio(window.devicePixelRatio);
    renderer.setSize(container.clientWidth, container.clientHeight);
    renderer.outputColorSpace = THREE.SRGBColorSpace;
    renderer.shadowMap.enabled = true;
    container.appendChild(renderer.domElement);

    const camera = new THREE.PerspectiveCamera(60, container.clientWidth / container.clientHeight, 0.1, 1000);
    camera.position.set(60, 45, 85);

    const controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.08;
    controls.target.set(0, 0, 0);
    controls.minDistance = 25;
    controls.maxDistance = 200;
    controls.maxPolarAngle = Math.PI * 0.48; // prevent going below ground

    // Lights
    const ambient = new THREE.AmbientLight(0x88ccff, 0.45);
    scene.add(ambient);

    const dirLight = new THREE.DirectionalLight(0x66ddff, 0.8);
    dirLight.position.set(40, 80, 40);
    dirLight.castShadow = true;
    dirLight.shadow.mapSize.set(1024, 1024);
    scene.add(dirLight);

    const rimLight = new THREE.DirectionalLight(0x00ffff, 0.35);
    rimLight.position.set(-60, 50, -40);
    scene.add(rimLight);

    // Ground
    const groundGeo = new THREE.PlaneGeometry(400, 400);
    const groundMat = new THREE.MeshStandardMaterial({
      color: 0x0a1a24,
      roughness: 0.95,
      metalness: 0.1
    });
    const ground = new THREE.Mesh(groundGeo, groundMat);
    ground.rotation.x = -Math.PI / 2;
    ground.receiveShadow = true;
    scene.add(ground);

    // Texture loader
    const textureLoader = new THREE.TextureLoader();
    const buildingTexture = textureLoader.load('textures/buildling_texture.jpg');
    buildingTexture.colorSpace = THREE.SRGBColorSpace;
    buildingTexture.wrapS = THREE.RepeatWrapping;
    buildingTexture.wrapT = THREE.RepeatWrapping;

    // Create a blocky city grid
    const cityGroup = new THREE.Group();
    scene.add(cityGroup);

    const cols = 14;   // number of buildings per row
    const rows = 10;   // number of rows
    const spacing = 9; // distance between building centers
    const baseSize = 4;

    for (let i = 0; i < cols; i++) {
      for (let j = 0; j < rows; j++) {
        // Randomized height and slight footprint variation
        const height = THREE.MathUtils.randFloat(12, 40);
        const w = baseSize + THREE.MathUtils.randFloat(-0.7, 0.7);
        const d = baseSize + THREE.MathUtils.randFloat(-0.7, 0.7);

        const geo = new THREE.BoxGeometry(w, height, d);

        // Slightly different texture scale per building
        const mat = new THREE.MeshStandardMaterial({
          map: buildingTexture,
          color: new THREE.Color().setHSL(0.6, 0.5, THREE.MathUtils.randFloat(0.45, 0.75)),
          roughness: 0.6,
          metalness: 0.3,
          emissive: new THREE.Color(0x002233),
          emissiveIntensity: 0.25
        });

        // Repeat texture vertically to avoid stretch
        buildingTexture.repeat.set(w / 4, height / 16);

        const mesh = new THREE.Mesh(geo, mat);
        mesh.castShadow = true;
        mesh.receiveShadow = true;

        const x = (i - cols / 2) * spacing;
        const z = (j - rows / 2) * spacing;
        mesh.position.set(x, height / 2, z);

        // Add a glowing edge effect via emissive outline planes (subtle)
        const glowMat = new THREE.MeshBasicMaterial({ color: 0x00ffff, transparent: true, opacity: 0.06 });
        const glow = new THREE.Mesh(new THREE.BoxGeometry(w * 1.06, height * 1.02, d * 1.06), glowMat);
        glow.position.copy(mesh.position);
        cityGroup.add(glow);

        cityGroup.add(mesh);
      }
    }

    // Neon horizon bloom-ish planes
    const horizonMat = new THREE.MeshBasicMaterial({ color: 0x00ffff, transparent: true, opacity: 0.06 });
    const horizon = new THREE.Mesh(new THREE.PlaneGeometry(400, 120), horizonMat);
    horizon.position.set(0, 60, -160);
    scene.add(horizon);

    // Subtle animation: city pulse + slight fog variation
    let t = 0;
    function animate() {
      requestAnimationFrame(animate);
      t += 0.005;
      cityGroup.rotation.y = Math.sin(t) * 0.01; // gentle sway
      scene.fog.density = 0.012 + Math.sin(t * 0.5) * 0.002;

      controls.update();
      renderer.render(scene, camera);
    }
    animate();

    // Handle resize
    function onResize() {
      const w = container.clientWidth;
      const h = container.clientHeight;
      camera.aspect = w / h;
      camera.updateProjectionMatrix();
      renderer.setSize(w, h);
    }
    window.addEventListener('resize', onResize);
    onResize();

    // Improve performance on tab switch
    document.addEventListener('visibilitychange', () => {
      renderer.setAnimationLoop(document.hidden ? null : animate);
    });
  </script>
</body>
</html>
